{% extends 'generic/object_create.html' %}
{% load form_helpers %}
{% load helpers %}

{% block form %}
    <div id="assign" class="tabcontent">
        <div class="panel panel-default">
            <div class="panel-heading"><strong>Action</strong></div>
            <div class="panel-body">
                {% render_field form.action %}
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading"><strong>Location Data</strong></div>
            <div class="panel-body">
                {% render_field form.location %}
                {% render_field form.name %}
                {% render_field form.phone %}
                {% render_field form.email %}
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading"><strong>Contact Association</strong></div>
            <div class="panel-body">
                {% render_field form.contact %}
                {% render_field form.team %}
                {% render_field form.role %}
                {% render_field form.status %}
            </div>
        </div>
    </div>
{% endblock %}

{% block buttons %}
    <button type="submit" name="_create" class="btn btn-primary">Assign</button>
    <a href="{{ return_url }}" class="btn btn-default">Cancel</a>
{% endblock %}

{% block javascript %}
<script>
    document.getElementById("id_location").disabled=true;

    // action drop down toggle
    const action = document.getElementById("id_action");
    function toggle_form_fields() {
        const action_option = action.value;
        const name = document.getElementById("id_name");
        const name_label = document.querySelector("label[for=id_name]");
        const phone = document.getElementById("id_phone");
        const email = document.getElementById("id_email");
        const similar_contacts_label = document.querySelector("label[for=id_contact]");
        const similar_contacts = document.getElementById("id_contact");
        const similar_teams_label = document.querySelector("label[for=id_team]");
        const similar_teams = document.getElementById("id_team");

        // Toggle these form fields when the action matches
        similar_contacts.toggleAttribute("required", action_option=="use existing contact");
        similar_teams.toggleAttribute("required", action_option=="use existing team");
        name.toggleAttribute("disabled", action_option.match(/use existing/));
        phone.toggleAttribute("disabled", action_option.match(/use existing/));
        email.toggleAttribute("disabled", action_option.match(/use existing/));

        // Show and hide form fields and toggle form field labels
        if (action_option === "use existing contact"){
            similar_contacts.parentElement.parentElement.style.display = "block";
            if (! similar_contacts_label.className.includes(" required")){
                similar_contacts_label.className += " required";
            }
            similar_teams.parentElement.parentElement.style.display = "none";
            if (similar_teams_label.className.includes(" required")){
                similar_teams_label.className = similar_teams_label.className.replace(" required", "");
            }
            if (name_label.className.includes(" required")){
                name_label.className = name_label.className.replace(" required", "");
            }
        } else if (action_option === "use existing team"){
            similar_teams.parentElement.parentElement.style.display = "block";
            if (! similar_teams_label.className.includes(" required")){
                similar_teams_label.className += " required";
            }
            similar_contacts.parentElement.parentElement.style.display = "none";
            if (similar_contacts_label.className.includes(" required")){
                similar_contacts_label.className = similar_contacts_label.className.replace(" required", "");
            }
            if (name_label.className.includes(" required")){
                name_label.className = name_label.className.replace(" required", "");
            }
        } else {
            similar_contacts.parentElement.parentElement.style.display = "none";
            similar_contacts.removeAttribute("required")
            if (similar_contacts_label.className.includes(" required")){
                similar_contacts_label.className = similar_contacts_label.className.replace(" required", "");
            }
            similar_teams.parentElement.parentElement.style.display = "none";
            similar_teams.removeAttribute("required")
            if (similar_teams_label.className.includes(" required")){
                similar_teams_label.className = similar_teams_label.className.replace(" required", "");
            }
            name.setAttribute("required", "")
            if (! name_label.className.includes(" required")){
                name_label.className += " required";
            }
        }

    }
    window.onload = toggle_form_fields
    action.onchange = toggle_form_fields
</script>
{% endblock %}