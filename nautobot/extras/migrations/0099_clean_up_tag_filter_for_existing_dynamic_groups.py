# Generated by Django 3.2.21 on 2023-10-16 14:54

from django.db import migrations


def clean_up_legacy_tag_filter(apps, schema):
    """
    Replace v1.x `tag` filter with v2.x `tags` filter in DynamicGroup filter data.
    """
    DynamicGroup = apps.get_model("extras", "DynamicGroup")
    for dp in DynamicGroup.objects.all():
        if "tag" in dp.filter:
            dp.filter["tags"] = dp.filter.pop("tag")
            dp.save()


def reverse_clean_up_legacy_tag_filter(apps, schema):
    """
    Replace v2.x `tags` filter with v1.x `tag` filter in DynamicGroup filter data.
    """
    DynamicGroup = apps.get_model("extras", "DynamicGroup")
    for dp in DynamicGroup.objects.all():
        if "tags" in dp.filter:
            dp.filter["tag"] = dp.filter.pop("tags")
            dp.save()


class Migration(migrations.Migration):
    dependencies = [
        ("extras", "0098_rename_data_jobresult_result"),
    ]

    operations = [
        migrations.RunPython(clean_up_legacy_tag_filter, reverse_clean_up_legacy_tag_filter),
    ]
