{% extends "base.html" %}
{% load helpers %}
{% load static %}
{% load ui_framework %}

{% block drawer %}
    {% table_config_form table %}
{% endblock %}

{% block content %}
    <div class="row d-print-none">
        <div class="col-lg-12">
            {% render_breadcrumbs %}
        </div>
    </div>

    <div class="float-end d-print-none">
        <div class="btn-group">
            <a class="btn btn-secondary set-apps-display" data-display="tiles" href="" title="Tiles">
                <span class="mdi mdi-view-grid{% if display == "list" %}-outline{% endif %}"></span>
            </a>
            <a class="btn btn-secondary set-apps-display" data-display="list" href="" title="List">
                <span class="mdi mdi-view-sequential{% if display == "tiles" %}-outline{% endif %}"></span>
            </a>
        </div>

        <a class="btn btn-primary" href="{% url 'apps:apps_marketplace' %}">Visit Apps Marketplace</a>
    </div>

    <h1>{% block page_heading %}{% render_title %}{% endblock %}</h1>

    <div class="row">
        <div class="col-lg-12">
            {% if filter_form %}
                <div class="col-lg-3 float-end nb-right-side-panel d-print-none">
                    {% include 'inc/search_panel.html' %}
                    {% block sidebar %}{% endblock %}
                </div>
            {% endif %}
            {% include table_template|default:'responsive_table.html' %}
            {% include 'inc/paginator.html' with paginator=table.paginator page=table.page %}
            <div class="clearfix"></div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script src="{% static 'js/tableconfig.js' %}"></script>

    <script>
    // Set display anchor links without losing other potentially active query params such as applied filters.
        [...document.querySelectorAll('.set-apps-display')].forEach(button => {
            const queryParams = new URLSearchParams(window.location.search);
            queryParams.set('display', button.dataset.display);
            button.setAttribute('href', `?${queryParams.toString()}`);
        });
    </script>
{% endblock %}
