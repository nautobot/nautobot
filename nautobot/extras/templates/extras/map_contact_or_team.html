{% extends 'generic/object_create.html' %}
{% load form_helpers %}
{% load helpers %}

{% block tabs %}
<style>
    .tabcontent {
        display: none;
    }
</style>
<ul class="nav nav-tabs" style="margin-bottom: 20px">
    <li role="presentation" {% if active_tab == 'assign' %}class="tablinks active"{% else %}class="tablinks"{% endif %} id="default_tab" onclick="openTab(event, 'assign')">
        <a>Assign to Similar Contact/Team</a>
    </li>
    <li role="presentation" {% if active_tab == 'contact' %}class="tablinks active"{% else %}class="tablinks"{% endif %} onclick="openTab(event, 'contact')">
        <a>Create New Contact</a>
    </li>
    <li role="presentation" {% if active_tab == 'team' %}class="tablinks active"{% else %}class="tablinks"{% endif %} onclick="openTab(event, 'team')">
        <a>Create New Team</a>
    </li>
</ul>
{% endblock %}

{% block form %}
    <div id="assign" class="tabcontent">
        <div class="panel panel-default">
            <div class="panel-heading"><strong>Contact Association</strong></div>
            <div class="panel-body">
                {% render_field form.location %}
                {% render_field form.contact %}
                {% render_field form.team %}
                {% render_field form.role %}
                {% render_field form.status %}
                {% render_field form.associated_object_type.as_hidden %}
                {% render_field form.associated_object_id.as_hidden %}
            </div>
        </div>
    </div>
    <div id="contact" class="tabcontent">
        <div class="panel panel-default">
            <div class="panel-heading"><strong>Contact</strong></div>
            <div class="panel-body">
                {% render_field form.contact_name %}
                {% render_field form.contact_phone %}
                {% render_field form.contact_email %}
                {% render_field form.contact_address %}
                {% render_field form.teams %}
                {% render_field form.comments %}
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading"><strong>Contact Association</strong></div>
            <div class="panel-body">
                {% render_field form.contact_role %}
                {% render_field form.contact_status %}
            </div>
        </div>
        {% include 'inc/extras_features_edit_form_fields.html' %}
    </div>
    <div id="team" class="tabcontent">
        <div class="panel panel-default">
            <div class="panel-heading"><strong>Team</strong></div>
            <div class="panel-body">
                {% render_field form.team_name %}
                {% render_field form.team_phone %}
                {% render_field form.team_email %}
                {% render_field form.team_address %}
                {% render_field form.team_contacts %}
                {% render_field form.comments %}
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading"><strong>Contact Association</strong></div>
            <div class="panel-body">
                {% render_field form.team_role %}
                {% render_field form.team_status %}
            </div>
        </div>
        {% include 'inc/extras_features_edit_form_fields.html' %}
    </div>
{% endblock %}

{% block buttons %}
    <button type="submit" name="_create" class="btn btn-primary">Assign</button>
    <a href="{{ return_url }}" class="btn btn-default">Cancel</a>
{% endblock %}

{% block javascript %}
<script>
    document.getElementById("id_location").disabled=true;
    var contact = document.getElementById("id_contact");
    var team = document.getElementById("id_team");
    function disable_enable_team(){
        if (team.disabled){
            team.disabled=false;
        } else {
            team.disabled=true;
        }
    }
    function disable_enable_contact(){
        if (contact.disabled){
            contact.disabled=false;
        } else {
            contact.disabled=true;
        }
    }
    contact.onchange = disable_enable_team;
    team.onchange = disable_enable_contact;
    function openTab(evt, tab_id) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tab_id).style.display = "block";
        evt.currentTarget.className += " active";
        if (tab_id === "assign") {
            // enable assign tab fields
            document.getElementById("id_contact").disabled = false;
            document.getElementById("id_team").disabled = false;
            document.getElementById("id_role").disabled = false;
            document.getElementById("id_status").disabled = false;

            // disable contact tab fields
            document.getElementById("id_contact_name").disabled=true;
            document.getElementById("id_contact_phone").disabled=true;
            document.getElementById("id_contact_email").disabled=true;
            document.getElementById("id_contact_address").disabled=true;
            document.getElementById("id_contact_role").disabled=true;
            document.getElementById("id_contact_status").disabled=true;
            document.getElementById("id_teams").disabled=true;

            // disable team tab fields
            document.getElementById("id_team_name").disabled=true;
            document.getElementById("id_team_phone").disabled=true;
            document.getElementById("id_team_email").disabled=true;
            document.getElementById("id_team_address").disabled=true;
            document.getElementById("id_team_role").disabled=true;
            document.getElementById("id_team_status").disabled=true;
            document.getElementById("id_contacts").disabled=true;
        } else if (tab_id === "contact") {
            // enable contact tab fields
            document.getElementById("id_contact_name").disabled=false;
            document.getElementById("id_contact_phone").disabled=false;
            document.getElementById("id_contact_email").disabled=false;
            document.getElementById("id_contact_address").disabled=false;
            document.getElementById("id_contact_role").disabled=false;
            document.getElementById("id_contact_status").disabled=false;
            document.getElementById("id_teams").disabled=false;

            // disable assign tab fields
            document.getElementById("id_contact").disabled = true;
            document.getElementById("id_team").disabled = true;
            document.getElementById("id_role").disabled = true;
            document.getElementById("id_status").disabled = true;

            // disable team tab fields
            document.getElementById("id_team_name").disabled=true;
            document.getElementById("id_team_phone").disabled=true;
            document.getElementById("id_team_email").disabled=true;
            document.getElementById("id_team_address").disabled=true;
            document.getElementById("id_team_role").disabled=true;
            document.getElementById("id_team_status").disabled=true;
            document.getElementById("id_contacts").disabled=true;
        } else {
            // enable team tab fields
            document.getElementById("id_team_name").disabled=false;
            document.getElementById("id_team_phone").disabled=false;
            document.getElementById("id_team_email").disabled=false;
            document.getElementById("id_team_address").disabled=false;
            document.getElementById("id_team_role").disabled=false;
            document.getElementById("id_team_status").disabled=false;
            document.getElementById("id_contacts").disabled=false;

            // disable assign tab fields
            document.getElementById("id_contact").disabled = true;
            document.getElementById("id_team").disabled = true;
            document.getElementById("id_role").disabled = true;
            document.getElementById("id_status").disabled = true;

            // disable contact tab fields
            document.getElementById("id_contact_name").disabled=true;
            document.getElementById("id_contact_phone").disabled=true;
            document.getElementById("id_contact_email").disabled=true;
            document.getElementById("id_contact_address").disabled=true;
            document.getElementById("id_contact_role").disabled=true;
            document.getElementById("id_contact_status").disabled=true;
            document.getElementById("id_teams").disabled=true;
        }
    }
    window.addEventListener("load", (event) => {
        document.getElementById("default_tab").click();
    });
</script>
{% endblock %}