{% extends 'generic/object_edit.html' %}
{% load static %}
{% load form_helpers %}

{% block form %}
    <div class="panel panel-default">
        <div class="panel-heading"><strong>External Integration</strong></div>
        <div class="panel-body">
            {% render_field form.name %}
            {% render_field form.remote_url %}
            {% render_field form.secrets_group %}
            {% render_field form.timeout %}
            {% render_field form.extra_config %}
        </div>
    </div>
    <div id="accordion" class="panel panel-default">
        <div class="panel-heading"><strong>Optional Configurations</strong>
            <button type="button" class="accordion-toggle mdi mdi-chevron-down" data-toggle="collapse" data-target=".collapseme">
            </button>
        </strong>
        </div>
        <div class="collapseme collapse in panel-body " data-parent="#accordion">
            {% render_field form.headers %}
            {% render_field form.http_method %}
            {% render_field form.ca_file_path %}
        </div>
    </div>
    
    {% include 'inc/extras_features_edit_form_fields.html' %}

{% endblock form %}

{% block javascript %}
{{ block.super }}
<script>
    // Toggle v -. >
    $("#accordion .accordion-toggle").click(function () {
        $(this).toggleClass("mdi-chevron-down mdi-chevron-right");
    });
    // Dynamically collapse/expand all when clicking the "Collapse All" button, and then update the button text.
    $('#accordion-toggle-all').click(function () {

        if ($(this).data("lastState") === null || $(this).data("lastState") === 1) {
            $('.collapse').collapse('show');
            $(this).data("lastState", 0);

            $("#accordion .accordion-toggle").addClass("mdi-chevron-down").removeClass("mdi-chevron-right");

            $(this).text("Collapse All");
        }
        else {
            $('[class^=collapseme]').removeData('bs.collapse').collapse({parent: false, toggle: false})
            .collapse('hide')
            .removeData('bs.collapse')
            .collapse({parent: '#accordion', toggle: false});

            $(this).data("lastState", 1);
            $("#accordion .accordion-toggle").addClass("mdi-chevron-right").removeClass("mdi-chevron-down");

            $(this).text("Expand All");
        }
    });
</script>

{% endblock javascript %}
