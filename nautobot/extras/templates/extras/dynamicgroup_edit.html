{% extends "generic/object_edit.html" %}
{% load static %}
{% load form_helpers %}

{% block form %}
    <div class="panel panel-default">
        <div class="panel-heading"><strong>Dynamic Group</strong></div>
        <div class="panel-body">
            {% render_field form.name %}
            {% render_field form.slug %}
            {% render_field form.description %}
            {% render_field form.content_type %}
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading"><strong>Filter Fields</strong></div>
        <div class="panel-body">
            {% if filter_form %}
            <span class="help-block">
                Select the filtering criteria to determine membership of objects matching the Content Type for this Dynamic Group. Fields that are not a dropdown are expected to have string inputs and do not support multiple values.
            </span>
            {% render_form filter_form %}
            {% else %}
            <span class="help-block">
                Filtering criteria will be available after initially saving this group and returning to this page.
            </span>
            {% endif %}
            {% if children.errors %}
                <div class="panel panel-danger">
                    <div class="panel-heading"><strong>Errors</strong></div>
                    <div class="panel-body">
                        Please correct the error(s) below:

                        {% for child in children.forms %}
                            {% if child.errors %}
                                {% for error in child.errors.values %}{{ error }}{% endfor %}
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            {{ children.non_field_errors }}
            <div class="form-group{% if children.errors %} has-error{% endif %}">
                <table class="table" id="children">
                    {{ children.management_form }}
                    {% for child_form in children.forms %}
                        {% if forloop.first %}
                            <thead>
                                <tr>
                                    {% for field in child_form.visible_fields %}
                                        <th>{{ field.label|capfirst }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                        {% endif %}
                        <tr class="formset_row-{{ children.prefix }}">
                            {% for field in child_form.visible_fields %}
                                <td>
                                    {% if forloop.first %}
                                        {% for hidden in child_form.hidden_fields %}
                                            {{ hidden }}
                                        {% endfor %}
                                    {% endif %}
                                    {{ field }}
                                    {% if field.errors %}
                                        <ul>
                                            {% for error in field.errors %}
                                                {# Embed an HTML comment indicating the error for extraction by tests #}
                                                <!-- FORM-ERROR {{ field.name }}: {{ error }} -->
                                                <li clas="text-danger">{{ error }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
    {% include 'inc/extras_features_edit_form_fields.html' %}
{% endblock form %}

{% block javascript %}
<script src="{% static 'jquery/jquery.formset.js' %}"></script>
<script type="text/javascript">
    $('.formset_row-{{ children.prefix }}').formset({
        addText: '<span class="mdi mdi-plus-thick" aria-hidden="true"></span> Add another Group',
        addCssClass: 'btn btn-primary add-row',
        deleteText: '<span class="mdi mdi-trash-can-outline" aria-hidden="true"></span>',
        deleteCssClass: 'btn btn-danger delete-row',
        prefix: '{{ children.prefix }}',
        formCssClass: 'dynamic-formset-{{ children.prefix }}',
    });
</script>
{% endblock javascript %}
